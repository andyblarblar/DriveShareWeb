<!DOCTYPE html>

<header>
    <title>Search</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css"
          integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="static/styles.css">
</header>

<body>
    <!-- Copy & Paste to Home, Listings, Reservations, etc (But not Login/Signup)-->
    <!-- Top Navbar -->
    <div id="header">
        <div id="nav-boxes" class="pure-g">
            <a class="pure-u-1-3 nav-box" id="assign-box" href="/">
                Home
            </a>
            <a class="pure-u-1-3 nav-box" id="assign-box" href="/searchlistings">
                Search
            </a>
            <a class="pure-u-1-3 nav-box" id="assign-box" href="/mylistings">
                My Listings
            </a>
            <a class="pure-u-1-3 nav-box" id="assign-box" href="/myreservations">
                My Reservations
            </a>
        </div>
        <div id="logout">
            <a id="logout-icon-holder" href="/logout">
                <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512">
                    <path d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 192 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l210.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128zM160 96c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 32C43 32 0 75 0 128L0 384c0 53 43 96 96 96l64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l64 0z"/>
                </svg>
            </a>
        </div>
    </div>
    <!-- End Navbar -->


    <!-- Begin Page Content -->
    <p>Search Listings</p>
    <!-- Button to call displayListings() function after popup message -->
    <button id="listButton" type="button" onclick="alert('Getting Listings')">Get Listings</button>

    <!-- Empty Description List to fill with Listings -->
    <dl id="listingGrid" class="listingContainer"></dl>

</body>


<script>
    const getList = document.getElementById("listButton")
    getList.addEventListener("click", displayListings)

    // Gets & Displays Listings
    // Probably a much better way to do this.
    async function displayListings() {
        // Fetch Listing JSON
        const response = await fetch("/listing");
        const allListings = await response.json();

        // Makes data var from allListings
        var data = allListings;

        // Gets the Listing Grid Container element in html as object
        var listingBox = document.getElementById("listingGrid")

        // For every listing in the JSON file
        for(var i = 0; i < data.length; i++) {
            // Select specific listing
            var obj = data[i];

            // Create Unordered List
            var LISTING = document.createElement("ul")

            // Create Description Term (Lable) for listing (Model)
            var modelA = document.createElement("dt");
            // Now that the element exists, make it display "Model"
            modelA.appendChild(document.createTextNode("Model"))

            // Create Description Description (Content) for listing (Model)
            var modelB = document.createElement("dd");
            // Make it display the Model information from the listing
            modelB.appendChild(document.createTextNode(obj.model));
            // Make the Model Information a child of the Model Lable
            modelA.appendChild(modelB)
            // Make the whole Model text a child of the overall listing Unordered List
            LISTING.appendChild(modelA)

            // Repeat for each aspect of listing

            var yearA = document.createElement("dt");
            yearA.appendChild(document.createTextNode("Year"))
            var yearB = document.createElement("dd");
            yearB.appendChild(document.createTextNode(obj.year));
            yearA.appendChild(yearB)
            LISTING.appendChild(yearA)

            var mileageA = document.createElement("dt");
            mileageA.appendChild(document.createTextNode("Mileage"))
            var mileageB = document.createElement("dd");
            mileageB.appendChild(document.createTextNode(obj.mileage));
            mileageA.appendChild(mileageB)
            LISTING.appendChild(mileageA)

            var locationA = document.createElement("dt");
            locationA.appendChild(document.createTextNode("Location"))
            var locationB = document.createElement("dd");
            locationB.appendChild(document.createTextNode(obj.location));
            locationA.appendChild(locationB)
            LISTING.appendChild(locationA)

            var priceA = document.createElement("dt");
            priceA.appendChild(document.createTextNode("Price"))
            var priceB = document.createElement("dd");
            priceB.appendChild(document.createTextNode("$" + obj.price));
            priceA.appendChild(priceB)
            LISTING.appendChild(priceA)

            var dateRangeA = document.createElement("dt");
            dateRangeA.appendChild(document.createTextNode("Date Range"))
            var dateRangeB = document.createElement("dd");
            dateRangeB.appendChild(document.createTextNode(obj.date_ranges));
            dateRangeA.appendChild(dateRangeB)
            LISTING.appendChild(dateRangeA)

            var ownerA = document.createElement("dt");
            ownerA.appendChild(document.createTextNode("Owner"))
            var ownerB = document.createElement("dd");
            ownerB.appendChild(document.createTextNode(obj.owner));
            ownerA.appendChild(ownerB)
            LISTING.appendChild(ownerA)

            // Add the Unordered list that contains all the listing info for one listing as a child to the description list
            listingBox.appendChild(LISTING);
        }

    }
</script>